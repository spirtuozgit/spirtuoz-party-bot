\# Spirtuoz Party Bot



Backend + Telegram Bot Ð´Ð»Ñ Ð¼Ð½Ð¾Ð³Ð¾Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ð¹ Ð¸Ð³Ñ€Ñ‹ \*\*Spirtuoz Party\*\*, Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‰ÐµÐ¹ Ñ‡ÐµÑ€ÐµÐ· Mini App Ð¸ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Host App Ñ WebSocket-Ñ‚ÑƒÐ½Ð½ÐµÐ»ÐµÐ¼ Ñ‡ÐµÑ€ÐµÐ· Cloudflare.



Ð‘Ð¾Ñ‚ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ Ñ€Ð¾Ð»ÑŒ "Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ñ…Ð°Ð±Ð°", ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹:

\- Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾Ð²Ñ‹Ðµ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹,

\- Ð²Ñ‹Ð´Ð°Ñ‘Ñ‚ Mini App Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ,

\- ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ WebApp-ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð´Ð»Ñ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²,

\- Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ API Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð°Ð²Ð°Ñ‚Ð°Ñ€Ð¾Ð² Telegram-Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹,

\- Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Host App Ñ‡ÐµÑ€ÐµÐ· ÑÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡.



---



\## ðŸš€ ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°



```

Host App â†’ Render Bot API â†’ Mini App

&nbsp;   â”‚              â”‚              â”‚

&nbsp;   â”‚--- registerRoom() -------->â”‚

&nbsp;   â”‚                            â”‚

&nbsp;   â”‚<-- MiniApp startapp=ROOM --â”‚

&nbsp;   â”‚                            â”‚

Cloudflare Tunnel   â†’ ws\_url â†’ Mini App â†’ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¼Ñƒ WS

```



Ð‘Ð¾Ñ‚ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ 3 ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ñ… API-ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ð°:

\- `POST /api/host/rooms/register` â€” Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹ (Host App â†’ Bot)

\- `GET /api/rooms/:room\_code` â€” Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ws\_url Ð¸ app\_url (Mini App â†’ Bot)

\- `GET /api/users/:id/avatar` â€” Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ URL Ð°Ð²Ð°Ñ‚Ð°Ñ€Ð° (Mini App â†’ Bot)



---



\## ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°



```

npm install

```



---



\## â–¶ï¸ Ð—Ð°Ð¿ÑƒÑÐº



```

npm start

```



ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ ÑÐµÑ€Ð²ÐµÑ€ ÑÑ‚Ð°Ñ€Ñ‚ÑƒÐµÑ‚ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ `3000`.



---



\## ðŸ”§ ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ (.env)



Ð¡Ð¾Ð·Ð´Ð°Ð¹ `.env` Ð½Ð° Render:



```

BOT\_TOKEN=YOUR\_TELEGRAM\_BOT\_TOKEN

HOST\_SECRET=SUPERSECRET

PUBLIC\_URL=https://your-render-service.onrender.com

FILE\_API\_URL=https://api.telegram.org

```



\### Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ:



| ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ      | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ |

|-----------------|----------|

| `BOT\_TOKEN`     | Ð¢Ð¾ÐºÐµÐ½ Telegram-Ð±Ð¾Ñ‚Ð° |

| `HOST\_SECRET`   | Ð—Ð°Ñ‰Ð¸Ñ‚Ð° API: Ð·Ð½Ð°Ñ‚ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Host App |

| `PUBLIC\_URL`    | ÐŸÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ URL Render-ÑÐµÑ€Ð²Ð¸ÑÐ° (Ð±Ð¾Ñ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ ÐµÐ³Ð¾ Ð´Ð»Ñ Mini App ÐºÐ½Ð¾Ð¿ÐºÐ¸) |

| `FILE\_API\_URL`  | URL Telegram File API (Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ Ð½Ðµ Ð¼ÐµÐ½ÑÐµÑ‚ÑÑ) |



---



\## ðŸ“ API Ð­Ð½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ñ‹



\### 1) \*\*POST /api/host/rooms/register\*\*



Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹ Ð¾Ñ‚ Host App.



\*\*Body:\*\*

```json

{

&nbsp; "room\_code": "ABCD",

&nbsp; "ws\_url": "wss://cloudflare-tunnel/ws",

&nbsp; "app\_url": "https://miniapp-url.vercel.app",

&nbsp; "host\_secret": "SUPERSECRET"

}

```



\### 2) \*\*GET /api/rooms/:code\*\*



ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð¾ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ðµ (Mini App).



\*\*Response:\*\*

```json

{

&nbsp; "room\_code": "ABCD",

&nbsp; "ws\_url": "wss://cloudflare-tunnel/ws",

&nbsp; "app\_url": "https://miniapp-url.vercel.app",

&nbsp; "created\_at": 1710000000000

}

```



\### 3) \*\*GET /api/users/:id/avatar\*\*



Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ URL Ð°Ð²Ð°Ñ‚Ð°Ñ€Ð° Telegram-Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ.



\*\*Response:\*\*

```json

{ "avatar": "https://api.telegram.org/file/.../avatar.jpg" }

```



---



\## ðŸ§© Ð›Ð¾Ð³Ð¸ÐºÐ° ÐºÐ¾Ð¼Ð½Ð°Ñ‚



Host App ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñƒ â†’ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð±Ð¾Ñ‚Ñƒ ÐµÑ‘ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ.  

Ð‘Ð¾Ñ‚ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹ Ð² `Map()` (in-memory).  



ÐšÐ¾Ð³Ð´Ð° Mini App Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· Telegram WebApp, Ð¾Ð½Ð° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ `room\_code` â†’ Ð±Ð¾Ñ‚ Ð²Ñ‹Ð´Ð°Ñ‘Ñ‚ `ws\_url`, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð²ÐµÐ´Ñ‘Ñ‚ Ñ‡ÐµÑ€ÐµÐ· Cloudflare Tunnel Ð½Ð° Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ WebSocket ÑÐµÑ€Ð²ÐµÑ€Ð° Ñ…Ð¾ÑÑ‚Ð°.



---



\## ðŸ–¼ Ð›Ð¾Ð³Ð¸ÐºÐ° Ð°Ð²Ð°Ñ‚Ð°Ñ€Ð¾Ð²



Ð¤Ð°Ð¹Ð» `avatars.js`:



\- Ð·Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÑ‚ Ñ„Ð¾Ñ‚Ð¾ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ Ñƒ Telegram,

\- Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÑ‚ Ð¿Ñ€ÑÐ¼ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° Ñ„Ð°Ð¹Ð»,

\- ÐºÐµÑˆÐ¸Ñ€ÑƒÐµÑ‚ Ð² Ð¿Ð°Ð¼ÑÑ‚Ð¸,

\- Ð¾Ñ‚Ð´Ð°Ñ‘Ñ‚ Mini App Ñ‡ÐµÑ€ÐµÐ· `/api/users/:id/avatar`.



---



\## ðŸ“‚ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°



```

spirtuoz-party-bot/

â”‚

â”œâ”€ server.js         # HTTP API + Ð·Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð°

â”œâ”€ bot.js            # Telegram WebApp logic

â”œâ”€ rooms.js          # Ñ…Ñ€Ð°Ð½Ð¸Ð»Ð¸Ñ‰Ðµ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… ÐºÐ¾Ð¼Ð½Ð°Ñ‚

â”œâ”€ avatars.js        # Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¸ ÐºÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð°Ð²Ð°Ñ‚Ð°Ñ€Ð¾Ð²

â”œâ”€ package.json

â”œâ”€ README.md

â””â”€ .env.example

```



---



\## ðŸŒ Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð½Ð° Render



1\. Ð—Ð°Ð»ÐµÐ¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð½Ð° GitHub  

2\. Ð¡Ð¾Ð·Ð´Ð°Ð¹ Render Web Service  

3\. Build Command:  

```

npm install

```

4\. Start Command:  

```

npm start

```

5\. Ð—Ð°Ð¿Ð¾Ð»Ð½Ð¸ .env  

6\. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸ ÑÐµÑ€Ð²Ð¸Ñ



---



\## ðŸŽ® Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ ÑˆÐ°Ð³



ÐŸÐ¾ÑÐ»Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ð³Ð¾ Ð´ÐµÐ¿Ð»Ð¾Ñ Ð±Ð¾Ñ‚Ð° Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ñ‚ÑŒ Ðº:



âž¡ \*\*Host App\*\*  

(Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ WebSocket + UI + Cloudflare Tunnel + Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹)





